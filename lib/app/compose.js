"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = compose;

var _errors = require("../errors");

function compose(stack, context) {
  const iterator = stack.values();

  return function next() {
    const handler = iterator.next().value;

    /* Check if a handler is present and valid. */
    if (!handler) {
      throw new _errors.NotFound("Endpoint does not exist");
    }

    if (typeof handler !== "function") {
      throw new _errors.InternalServerError("Bad handler");
    }

    // ES7: return context::handler(next)
    return handler.call(context, next);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcHAvY29tcG9zZS5qcyJdLCJuYW1lcyI6WyJjb21wb3NlIiwic3RhY2siLCJjb250ZXh0IiwiaXRlcmF0b3IiLCJ2YWx1ZXMiLCJuZXh0IiwiaGFuZGxlciIsInZhbHVlIiwiTm90Rm91bmQiLCJJbnRlcm5hbFNlcnZlckVycm9yIiwiY2FsbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7a0JBTXdCQSxPOztBQUx4Qjs7QUFLZSxTQUFTQSxPQUFULENBQWlCQyxLQUFqQixFQUErQkMsT0FBL0IsRUFBdUQ7QUFDcEUsUUFBTUMsV0FBV0YsTUFBTUcsTUFBTixFQUFqQjs7QUFFQSxTQUFPLFNBQVNDLElBQVQsR0FBZ0I7QUFDckIsVUFBTUMsVUFBVUgsU0FBU0UsSUFBVCxHQUFnQkUsS0FBaEM7O0FBRUE7QUFDQSxRQUFJLENBQUNELE9BQUwsRUFBYztBQUNaLFlBQU0sSUFBSUUsZ0JBQUosQ0FBYSx5QkFBYixDQUFOO0FBQ0Q7O0FBRUQsUUFBSSxPQUFPRixPQUFQLEtBQW1CLFVBQXZCLEVBQW1DO0FBQ2pDLFlBQU0sSUFBSUcsMkJBQUosQ0FBd0IsYUFBeEIsQ0FBTjtBQUNEOztBQUVEO0FBQ0EsV0FBT0gsUUFBUUksSUFBUixDQUFhUixPQUFiLEVBQXNCRyxJQUF0QixDQUFQO0FBQ0QsR0FkRDtBQWVEIiwiZmlsZSI6ImNvbXBvc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBAZmxvdyAqL1xuaW1wb3J0IHtOb3RGb3VuZCwgSW50ZXJuYWxTZXJ2ZXJFcnJvcn0gZnJvbSBcIi4uL2Vycm9yc1wiXG5cbmltcG9ydCB0eXBlIHtDb250ZXh0fSBmcm9tIFwiLi9jb250ZXh0XCJcbmltcG9ydCB0eXBlIHtOZXh0LCBTdGFja30gZnJvbSBcIi4uL21pZGRsZXdhcmVcIlxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjb21wb3NlKHN0YWNrOiBTdGFjaywgY29udGV4dDogQ29udGV4dCk6IE5leHQge1xuICBjb25zdCBpdGVyYXRvciA9IHN0YWNrLnZhbHVlcygpXG5cbiAgcmV0dXJuIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgY29uc3QgaGFuZGxlciA9IGl0ZXJhdG9yLm5leHQoKS52YWx1ZVxuXG4gICAgLyogQ2hlY2sgaWYgYSBoYW5kbGVyIGlzIHByZXNlbnQgYW5kIHZhbGlkLiAqL1xuICAgIGlmICghaGFuZGxlcikge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kKFwiRW5kcG9pbnQgZG9lcyBub3QgZXhpc3RcIilcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGhhbmRsZXIgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3IoXCJCYWQgaGFuZGxlclwiKVxuICAgIH1cblxuICAgIC8vIEVTNzogcmV0dXJuIGNvbnRleHQ6OmhhbmRsZXIobmV4dClcbiAgICByZXR1cm4gaGFuZGxlci5jYWxsKGNvbnRleHQsIG5leHQpXG4gIH1cbn1cbiJdfQ==