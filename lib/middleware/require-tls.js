"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = requireTLS;

var _errors = require("../errors");

/* eslint-disable no-unused-expressions */
function requireTLS() {
  return function requireTLS(next) {
    this;

    const socket = this.request.socket;

    if (socket.encrypted) return next();
    if (this.get("x-forwarded-proto") === "https") return next();
    if (process.env.NODE_ENV === "development") return next();

    throw new _errors.Forbidden("TLS required");
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL3JlcXVpcmUtdGxzLmpzIl0sIm5hbWVzIjpbInJlcXVpcmVUTFMiLCJuZXh0Iiwic29ja2V0IiwicmVxdWVzdCIsImVuY3J5cHRlZCIsImdldCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViJdLCJtYXBwaW5ncyI6Ijs7Ozs7a0JBTXdCQSxVOztBQUZ4Qjs7QUFIQTtBQUtlLFNBQVNBLFVBQVQsR0FBa0M7QUFDL0MsU0FBTyxTQUFTQSxVQUFULENBQW9CQyxJQUFwQixFQUFnQztBQUNwQyxRQUFEOztBQUVBLFVBQU1DLFNBQXFDLEtBQUtDLE9BQUwsQ0FBYUQsTUFBeEQ7O0FBRUEsUUFBSUEsT0FBT0UsU0FBWCxFQUFzQixPQUFPSCxNQUFQO0FBQ3RCLFFBQUksS0FBS0ksR0FBTCxDQUFTLG1CQUFULE1BQWtDLE9BQXRDLEVBQStDLE9BQU9KLE1BQVA7QUFDL0MsUUFBSUssUUFBUUMsR0FBUixDQUFZQyxRQUFaLEtBQXlCLGFBQTdCLEVBQTRDLE9BQU9QLE1BQVA7O0FBRTVDLFVBQU0sc0JBQWMsY0FBZCxDQUFOO0FBQ0QsR0FWRDtBQVdEIiwiZmlsZSI6InJlcXVpcmUtdGxzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC1leHByZXNzaW9ucyAqL1xuaW1wb3J0IHR5cGUge0NvbnRleHQsIE5leHQsIE1pZGRsZXdhcmV9IGZyb20gXCIuLi9taWRkbGV3YXJlXCJcblxuaW1wb3J0IHtGb3JiaWRkZW59IGZyb20gXCIuLi9lcnJvcnNcIlxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiByZXF1aXJlVExTKCk6IE1pZGRsZXdhcmUge1xuICByZXR1cm4gZnVuY3Rpb24gcmVxdWlyZVRMUyhuZXh0OiBOZXh0KSB7XG4gICAgKHRoaXM6IENvbnRleHQpXG5cbiAgICBjb25zdCBzb2NrZXQ6IHRscyRUTFNTb2NrZXQgfCBuZXQkU29ja2V0ID0gdGhpcy5yZXF1ZXN0LnNvY2tldFxuXG4gICAgaWYgKHNvY2tldC5lbmNyeXB0ZWQpIHJldHVybiBuZXh0KClcbiAgICBpZiAodGhpcy5nZXQoXCJ4LWZvcndhcmRlZC1wcm90b1wiKSA9PT0gXCJodHRwc1wiKSByZXR1cm4gbmV4dCgpXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCIpIHJldHVybiBuZXh0KClcblxuICAgIHRocm93IG5ldyBGb3JiaWRkZW4oXCJUTFMgcmVxdWlyZWRcIilcbiAgfVxufVxuIl19