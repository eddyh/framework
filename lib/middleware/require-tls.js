"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = requireTLS;

var _errors = require("../errors");

function requireTLS() {
  return function requireTLS(next) {
    const ctx = this;
    const socket = ctx.req.socket;

    if (socket.encrypted) return next();
    if (ctx.req.headers["x-forwarded-proto"] === "https") return next();
    if (process.env.NODE_ENV === "development") return next();

    throw new _errors.Forbidden("TLS required");
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL3JlcXVpcmUtdGxzLmpzIl0sIm5hbWVzIjpbInJlcXVpcmVUTFMiLCJuZXh0IiwiY3R4Iiwic29ja2V0IiwicmVxIiwiZW5jcnlwdGVkIiwiaGVhZGVycyIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViJdLCJtYXBwaW5ncyI6Ijs7Ozs7a0JBS3dCQSxVOztBQUZ4Qjs7QUFFZSxTQUFTQSxVQUFULEdBQWtDO0FBQy9DLFNBQU8sU0FBU0EsVUFBVCxDQUFvQkMsSUFBcEIsRUFBZ0M7QUFDckMsVUFBTUMsTUFBZSxJQUFyQjtBQUNBLFVBQU1DLFNBQXFDRCxJQUFJRSxHQUFKLENBQVFELE1BQW5EOztBQUVBLFFBQUlBLE9BQU9FLFNBQVgsRUFBc0IsT0FBT0osTUFBUDtBQUN0QixRQUFJQyxJQUFJRSxHQUFKLENBQVFFLE9BQVIsQ0FBZ0IsbUJBQWhCLE1BQXlDLE9BQTdDLEVBQXNELE9BQU9MLE1BQVA7QUFDdEQsUUFBSU0sUUFBUUMsR0FBUixDQUFZQyxRQUFaLEtBQXlCLGFBQTdCLEVBQTRDLE9BQU9SLE1BQVA7O0FBRTVDLFVBQU0sc0JBQWMsY0FBZCxDQUFOO0FBQ0QsR0FURDtBQVVEIiwiZmlsZSI6InJlcXVpcmUtdGxzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cbmltcG9ydCB0eXBlIHtDb250ZXh0LCBOZXh0LCBNaWRkbGV3YXJlfSBmcm9tIFwiLi4vbWlkZGxld2FyZVwiXG5cbmltcG9ydCB7Rm9yYmlkZGVufSBmcm9tIFwiLi4vZXJyb3JzXCJcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVxdWlyZVRMUygpOiBNaWRkbGV3YXJlIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIHJlcXVpcmVUTFMobmV4dDogTmV4dCkge1xuICAgIGNvbnN0IGN0eDogQ29udGV4dCA9IHRoaXNcbiAgICBjb25zdCBzb2NrZXQ6IHRscyRUTFNTb2NrZXQgfCBuZXQkU29ja2V0ID0gY3R4LnJlcS5zb2NrZXRcblxuICAgIGlmIChzb2NrZXQuZW5jcnlwdGVkKSByZXR1cm4gbmV4dCgpXG4gICAgaWYgKGN0eC5yZXEuaGVhZGVyc1tcIngtZm9yd2FyZGVkLXByb3RvXCJdID09PSBcImh0dHBzXCIpIHJldHVybiBuZXh0KClcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIikgcmV0dXJuIG5leHQoKVxuXG4gICAgdGhyb3cgbmV3IEZvcmJpZGRlbihcIlRMUyByZXF1aXJlZFwiKVxuICB9XG59XG4iXX0=