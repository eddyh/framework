"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Logger = undefined;

var _memoryConsole = require("./memory-console");

var _memoryConsole2 = _interopRequireDefault(_memoryConsole);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry */
/* https://github.com/GoogleCloudPlatform/fluent-plugin-google-cloud/blob/master/lib/fluent/plugin/out_google_cloud.rb */
/* Note, this is actually the contents of jsonPayload, so it can contain
   arbitrary fields! */
let Logger = exports.Logger = class Logger {

  static get formatter() {
    return process.env.NODE_ENV === "development" ? Logger.PRETTY : Logger.JSON;
  }

  static get console() {
    return process.env.NODE_ENV === "test" ? new _memoryConsole2.default() : console;
  }

  constructor(console = Logger.console, formatter = Logger.formatter) {
    this.console = console;
    this.formatter = formatter;

    Object.freeze(this);
  }

  write(severity, message, context) {
    const entry = {
      time: new Date(),
      message: typeof message === "object" ? JSON.stringify(message) : String(message),
      severity
    };

    this.console.log(this.formatter(Object.assign(entry, context)));
  }

  debug(message, context = Object.seal({})) {
    this.write("DEBUG", message, context);
  }

  info(message, context = Object.seal({})) {
    this.write("INFO", message, context);
  }

  notice(message, context = Object.seal({})) {
    this.write("NOTICE", message, context);
  }

  warning(message, context = Object.seal({})) {
    this.write("WARNING", message, context);
  }

  error(message, context = Object.seal({})) {
    this.write("ERROR", message, context);
  }

  critical(message, context = Object.seal({})) {
    this.write("CRITICAL", message, context);
  }
};
Logger.JSON = JSON.stringify;

Logger.PRETTY = entry => {
  const reset = "\x1b[0m";
  const bold = "\x1b[1m";

  const black = "\x1b[30m";
  const red = "\x1b[31m";
  const green = "\x1b[32m";
  const yellow = "\x1b[33m";
  // const blue = "\x1b[34m"

  const dateOptions = {
    year: "numeric",
    month: "short",
    day: "numeric",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    hour12: false
  };

  const styles = {
    DEBUG: black + bold,
    INFO: reset,
    NOTICE: green + bold,
    WARNING: yellow + bold,
    ERROR: red + bold,
    CRITICAL: red + bold,
    ALERT: red + bold,
    EMERGENCY: red + bold
  };

  const time = `[${entry.time.toLocaleString("en", dateOptions)}]`;

  let http = "";
  if (entry.httpRequest) {
    const { remoteIp, requestMethod, requestUrl, status, responseSize } = entry.httpRequest;
    http = `${remoteIp || "unknown"} - ${requestMethod.toUpperCase()} ${requestUrl} ${status} ${responseSize} - `;
  }

  return `${time} ${styles[entry.severity]}${http}${entry.message}${reset}`;
};

exports.default = Logger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2xvZ2dlci5qcyJdLCJuYW1lcyI6WyJMb2dnZXIiLCJmb3JtYXR0ZXIiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJQUkVUVFkiLCJKU09OIiwiY29uc29sZSIsImNvbnN0cnVjdG9yIiwiT2JqZWN0IiwiZnJlZXplIiwid3JpdGUiLCJzZXZlcml0eSIsIm1lc3NhZ2UiLCJjb250ZXh0IiwiZW50cnkiLCJ0aW1lIiwiRGF0ZSIsInN0cmluZ2lmeSIsIlN0cmluZyIsImxvZyIsImFzc2lnbiIsImRlYnVnIiwic2VhbCIsImluZm8iLCJub3RpY2UiLCJ3YXJuaW5nIiwiZXJyb3IiLCJjcml0aWNhbCIsInJlc2V0IiwiYm9sZCIsImJsYWNrIiwicmVkIiwiZ3JlZW4iLCJ5ZWxsb3ciLCJkYXRlT3B0aW9ucyIsInllYXIiLCJtb250aCIsImRheSIsImhvdXIiLCJtaW51dGUiLCJzZWNvbmQiLCJob3VyMTIiLCJzdHlsZXMiLCJERUJVRyIsIklORk8iLCJOT1RJQ0UiLCJXQVJOSU5HIiwiRVJST1IiLCJDUklUSUNBTCIsIkFMRVJUIiwiRU1FUkdFTkNZIiwidG9Mb2NhbGVTdHJpbmciLCJodHRwIiwiaHR0cFJlcXVlc3QiLCJyZW1vdGVJcCIsInJlcXVlc3RNZXRob2QiLCJyZXF1ZXN0VXJsIiwic3RhdHVzIiwicmVzcG9uc2VTaXplIiwidG9VcHBlckNhc2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQTs7Ozs7O0FBMkJBO0FBQ0E7QUFDQTs7SUFhYUEsTSxXQUFBQSxNLEdBQU4sTUFBTUEsTUFBTixDQUFhOztBQWdEbEIsYUFBV0MsU0FBWCxHQUF1QjtBQUNyQixXQUFPQyxRQUFRQyxHQUFSLENBQVlDLFFBQVosS0FBeUIsYUFBekIsR0FBeUNKLE9BQU9LLE1BQWhELEdBQXlETCxPQUFPTSxJQUF2RTtBQUNEOztBQUVELGFBQVdDLE9BQVgsR0FBcUI7QUFDbkIsV0FBT0wsUUFBUUMsR0FBUixDQUFZQyxRQUFaLEtBQXlCLE1B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O0FBV0EsUUFBTWQsT0FBUSxJQUFHRCxNQUFNQyxJQUFOLENBQVdvQyxjQUFYLENBQTBCLElBQTFCLEVBQWdDakIsV0FBaEMsQ0FBNkMsR0FBOUQ7O0FBRUEsTUFBSWtCLE9BQU8sRUFBWDtBQUNBLE1BQUl0QyxNQUFNdUMsV0FBVixFQUF1QjtBQUNyQixVQUFNLEVBQUNDLFFBQUQsRUFBV0MsYUFBWCxFQUEwQkMsVUFBMUIsRUFBc0NDLE1BQXRDLEVBQThDQyxZQUE5QyxLQUE4RDVDLE1BQU11QyxXQUExRTtBQUNBRCxXQUFRLEdBQUVFLFlBQVksU0FBVSxNQUFLQyxjQUFjSSxXQUFkLEVBQTRCLElBQUdILFVBQVcsSUFBR0MsTUFBTyxJQUFHQyxZQUFhLEtBQXpHO0FBQ0Q7O0FBRUQsU0FBUSxHQUFFM0MsSUFBSyxJQUFHMkIsT0FBTzVCLE1BQU1ILFFBQWIsQ0FBdUIsR0FBRXlDLElBQUssR0FBRXRDLE1BQU1GLE9BQVEsR0FBRWdCLEtBQU0sRUFBeEU7QUFDRCxDOztrQkFvRFk3QixNIiwiZmlsZSI6ImxvZ2dlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIEBmbG93ICovXG5pbXBvcnQgTWVtb3J5Q29uc29sZSBmcm9tIFwiLi9tZW1vcnktY29uc29sZVwiXG5cbmV4cG9ydCB0eXBlIEh0dHBSZXF1ZXN0ID0ge3xcbiAgcmVxdWVzdE1ldGhvZDogc3RyaW5nLFxuICByZXF1ZXN0VXJsOiBzdHJpbmcsXG4gIHJlcXVlc3RTaXplOiBudW1iZXIsXG4gIHN0YXR1czogbnVtYmVyLFxuICByZXNwb25zZVNpemU6IG51bWJlcixcbiAgdXNlckFnZW50Pzogc3RyaW5nLFxuICByZW1vdGVJcD86IHN0cmluZyxcbiAgcmVmZXJlcj86IHN0cmluZyxcbiAgbGF0ZW5jeT86IHN0cmluZyxcbiAgY2FjaGVIaXQ/OiBib29sZWFuLFxuICBjYWNoZVZhbGlkYXRlZFdpdGhPcmlnaW5TZXJ2ZXI/OiBib29sZWFuLFxufH1cblxuZXhwb3J0IHR5cGUgTG9nU2V2ZXJpdHkgPSAoXG4gIFwiREVCVUdcIiB8XG4gIFwiSU5GT1wiIHxcbiAgXCJOT1RJQ0VcIiB8XG4gIFwiV0FSTklOR1wiIHxcbiAgXCJFUlJPUlwiIHxcbiAgXCJDUklUSUNBTFwiIHxcbiAgXCJBTEVSVFwiIHxcbiAgXCJFTUVSR0VOQ1lcIlxuKVxuXG4vKiBodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vbG9nZ2luZy9kb2NzL3JlZmVyZW5jZS92Mi9yZXN0L3YyL0xvZ0VudHJ5ICovXG4vKiBodHRwczovL2dpdGh1Yi5jb20vR29vZ2xlQ2xvdWRQbGF0Zm9ybS9mbHVlbnQtcGx1Z2luLWdvb2dsZS1jbG91ZC9ibG9iL21hc3Rlci9saWIvZmx1ZW50L3BsdWdpbi9vdXRfZ29vZ2xlX2Nsb3VkLnJiICovXG4vKiBOb3RlLCB0aGlzIGlzIGFjdHVhbGx5IHRoZSBjb250ZW50cyBvZiBqc29uUGF5bG9hZCwgc28gaXQgY2FuIGNvbnRhaW5cbiAgIGFyYml0cmFyeSBmaWVsZHMhICovXG5leHBvcnQgdHlwZSBMb2dFbnRyeSA9IHtcbiAgdGltZTogRGF0ZSxcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBzZXZlcml0eTogTG9nU2V2ZXJpdHksXG4gIGh0dHBSZXF1ZXN0PzogSHR0cFJlcXVlc3QsXG59XG5cbmV4cG9ydCB0eXBlIExvZ0NvbnRleHQgPSB7XG4gIGh0dHBSZXF1ZXN0PzogSHR0cFJlcXVlc3QsXG59XG5cbmV4cG9ydCBjbGFzcyBMb2dnZXIge1xuICBjb25zb2xlOiBjb25zb2xlLkNvbnNvbGVcbiAgZm9ybWF0dGVyOiBMb2dFbnRyeSA9PiBzdHJpbmdcblxuICBzdGF0aWMgSlNPTiA9IEpTT04uc3RyaW5naWZ5XG5cbiAgc3RhdGljIFBSRVRUWSA9IChlbnRyeTogTG9nRW50cnkpID0+IHtcbiAgICBjb25zdCByZXNldCA9IFwiXFx4MWJbMG1cIlxuICAgIGNvbnN0IGJvbGQgPSBcIlxceDFiWzFtXCJcblxuICAgIGNvbnN0IGJsYWNrID0gXCJcXHgxYlszMG1cIlxuICAgIGNvbnN0IHJlZCA9IFwiXFx4MWJbMzFtXCJcbiAgICBjb25zdCBncmVlbiA9IFwiXFx4MWJbMzJtXCJcbiAgICBjb25zdCB5ZWxsb3cgPSBcIlxceDFiWzMzbVwiXG4gICAgLy8gY29uc3QgYmx1ZSA9IFwiXFx4MWJbMzRtXCJcblxuICAgIGNvbnN0IGRhdGVPcHRpb25zID0ge1xuICAgICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgICBtb250aDogXCJzaG9ydFwiLFxuICAgICAgZGF5OiBcIm51bWVyaWNcIixcbiAgICAgIGhvdXI6IFwiMi1kaWdpdFwiLFxuICAgICAgbWludXRlOiBcIjItZGlnaXRcIixcbiAgICAgIHNlY29uZDogXCIyLWRpZ2l0XCIsXG4gICAgICBob3VyMTI6IGZhbHNlLFxuICAgIH1cblxuICAgIGNvbnN0IHN0eWxlcyA9IHtcbiAgICAgIERFQlVHOiBibGFjayArIGJvbGQsXG4gICAgICBJTkZPOiByZXNldCxcbiAgICAgIE5PVElDRTogZ3JlZW4gKyBib2xkLFxuICAgICAgV0FSTklORzogeWVsbG93ICsgYm9sZCxcbiAgICAgIEVSUk9SOiByZWQgKyBib2xkLFxuICAgICAgQ1JJVElDQUw6IHJlZCArIGJvbGQsXG4gICAgICBBTEVSVDogcmVkICsgYm9sZCxcbiAgICAgIEVNRVJHRU5DWTogcmVkICsgYm9sZCxcbiAgICB9XG5cbiAgICBjb25zdCB0aW1lID0gYFske2VudHJ5LnRpbWUudG9Mb2NhbGVTdHJpbmcoXCJlblwiLCBkYXRlT3B0aW9ucyl9XWBcblxuICAgIGxldCBodHRwID0gXCJcIlxuICAgIGlmIChlbnRyeS5odHRwUmVxdWVzdCkge1xuICAgICAgY29uc3Qge3JlbW90ZUlwLCByZXF1ZXN0TWV0aG9kLCByZXF1ZXN0VXJsLCBzdGF0dXMsIHJlc3BvbnNlU2l6ZX0gPSBlbnRyeS5odHRwUmVxdWVzdFxuICAgICAgaHR0cCA9IGAke3JlbW90ZUlwIHx8IFwidW5rbm93blwifSAtICR7cmVxdWVzdE1ldGhvZC50b1VwcGVyQ2FzZSgpfSAke3JlcXVlc3RVcmx9ICR7c3RhdHVzfSAke3Jlc3BvbnNlU2l6ZX0gLSBgXG4gICAgfVxuXG4gICAgcmV0dXJuIGAke3RpbWV9ICR7c3R5bGVzW2VudHJ5LnNldmVyaXR5XX0ke2h0dHB9JHtlbnRyeS5tZXNzYWdlfSR7cmVzZXR9YFxuICB9XG5cbiAgc3RhdGljIGdldCBmb3JtYXR0ZXIoKSB7XG4gICAgcmV0dXJuIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCIgPyBMb2dnZXIuUFJFVFRZIDogTG9nZ2VyLkpTT05cbiAgfVxuXG4gIHN0YXRpYyBnZXQgY29uc29sZSgpIHtcbiAgICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwidGVzdFwiID8gbmV3IE1lbW9yeUNvbnNvbGUgOiBjb25zb2xlXG4gIH1cblxuICBjb25zdHJ1Y3Rvcihjb25zb2xlOiBjb25zb2xlLkNvbnNvbGUgPSBMb2dnZXIuY29uc29sZSwgZm9ybWF0dGVyOiBMb2dFbnRyeSA9PiBzdHJpbmcgPSBMb2dnZXIuZm9ybWF0dGVyKSB7XG4gICAgdGhpcy5jb25zb2xlID0gY29uc29sZVxuICAgIHRoaXMuZm9ybWF0dGVyID0gZm9ybWF0dGVyXG5cbiAgICBPYmplY3QuZnJlZXplKHRoaXMpXG4gIH1cblxuICB3cml0ZShzZXZlcml0eTogTG9nU2V2ZXJpdHksIG1lc3NhZ2U6IG1peGVkLCBjb250ZXh0OiBMb2dDb250ZXh0KSB7XG4gICAgY29uc3QgZW50cnk6IExvZ0VudHJ5ID0ge1xuICAgICAgdGltZTogbmV3IERhdGUsXG4gICAgICBtZXNzYWdlOiB0eXBlb2YgbWVzc2FnZSA9PT0gXCJvYmplY3RcIiA/IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpIDogU3RyaW5nKG1lc3NhZ2UpLFxuICAgICAgc2V2ZXJpdHksXG4gICAgfVxuXG4gICAgdGhpcy5jb25zb2xlLmxvZyh0aGlzLmZvcm1hdHRlcihPYmplY3QuYXNzaWduKGVudHJ5LCBjb250ZXh0KSkpXG4gIH1cblxuICBkZWJ1ZyhtZXNzYWdlOiBtaXhlZCwgY29udGV4dDogTG9nQ29udGV4dCA9IE9iamVjdC5zZWFsKHt9KSkge1xuICAgIHRoaXMud3JpdGUoXCJERUJVR1wiLCBtZXNzYWdlLCBjb250ZXh0KVxuICB9XG5cbiAgaW5mbyhtZXNzYWdlOiBtaXhlZCwgY29udGV4dDogTG9nQ29udGV4dCA9IE9iamVjdC5zZWFsKHt9KSkge1xuICAgIHRoaXMud3JpdGUoXCJJTkZPXCIsIG1lc3NhZ2UsIGNvbnRleHQpXG4gIH1cblxuICBub3RpY2UobWVzc2FnZTogbWl4ZWQsIGNvbnRleHQ6IExvZ0NvbnRleHQgPSBPYmplY3Quc2VhbCh7fSkpIHtcbiAgICB0aGlzLndyaXRlKFwiTk9USUNFXCIsIG1lc3NhZ2UsIGNvbnRleHQpXG4gIH1cblxuICB3YXJuaW5nKG1lc3NhZ2U6IG1peGVkLCBjb250ZXh0OiBMb2dDb250ZXh0ID0gT2JqZWN0LnNlYWwoe30pKSB7XG4gICAgdGhpcy53cml0ZShcIldBUk5JTkdcIiwgbWVzc2FnZSwgY29udGV4dClcbiAgfVxuXG4gIGVycm9yKG1lc3NhZ2U6IG1peGVkLCBjb250ZXh0OiBMb2dDb250ZXh0ID0gT2JqZWN0LnNlYWwoe30pKSB7XG4gICAgdGhpcy53cml0ZShcIkVSUk9SXCIsIG1lc3NhZ2UsIGNvbnRleHQpXG4gIH1cblxuICBjcml0aWNhbChtZXNzYWdlOiBtaXhlZCwgY29udGV4dDogTG9nQ29udGV4dCA9IE9iamVjdC5zZWFsKHt9KSkge1xuICAgIHRoaXMud3JpdGUoXCJDUklUSUNBTFwiLCBtZXNzYWdlLCBjb250ZXh0KVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IExvZ2dlclxuIl19